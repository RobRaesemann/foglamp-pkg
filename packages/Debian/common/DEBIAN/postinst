#!/bin/sh

##--------------------------------------------------------------------
## Copyright (c) 2018 OSIsoft, LLC
##
## Licensed under the Apache License, Version 2.0 (the "License");
## you may not use this file except in compliance with the License.
## You may obtain a copy of the License at
##
##     http://www.apache.org/licenses/LICENSE-2.0
##
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.
##--------------------------------------------------------------------

##--------------------------------------------------------------------
##
## @postinst DEBIAN/postinst
## This script is used to execute post installation tasks.
##
## Author: Ivan Zoratti
##
##--------------------------------------------------------------------

set -e

SSL_NAME="foglamp"
SSL_DAYS="365"
PKG_NAME="foglamp"

copy_service_file() {
    cp /usr/local/foglamp/extras/scripts/foglamp.service /etc/init.d/foglamp
}

enable_foglamp_service() {
    systemctl enable foglamp
}

start_foglamp_service() {
    systemctl start foglamp
}

set_files_ownership () {
    chown root:root /etc/init.d/foglamp
    chown -R root:root /usr/local/foglamp
    chown -R ${SUDO_USER}:${SUDO_USER} /usr/local/foglamp/data
}

generate_certs () {
    cd /usr/local/foglamp
    ./scripts/certificates ${SSL_NAME} ${SSL_DAYS}
}

# main
copy_service_file
generate_certs
set_files_ownership
enable_foglamp_service
start_foglamp_service




